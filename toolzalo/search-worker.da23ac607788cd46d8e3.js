__ZaBUNDLENAME__="search-worker","object"!=typeof globalThis&&(globalThis=self),function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="https://zalo-chat-static.zadn.vn/v1/",r(r.s=15)}({"/EgQ":function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},15:function(e,t,r){e.exports=r("7F/P")},"39uu":function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},"4c4j":function(e,t,r){"use strict";r.r(t),r.d(t,"ZDB",(function(){return ge}));var n={};r.r(n),r.d(n,"RollDB",(function(){return q}));var o=r("VTBJ");const s="undefined"!=typeof window&&"Microsoft Internet Explorer"==(null===(i=window)||void 0===i||null===(a=i.navigator)||void 0===a?void 0:a.appName);var i,a;class l{static encrypt(e,{key:t=""}={}){if(!t)throw new Error("key is not set!");let r=0,n=[];if(s){let r=0,o=e.length;for(let e=0;e<t.length;e++)r+=t.charCodeAt(e);r%=o;for(let t=0;t<e.length;t++)n.push(String.fromCharCode(e.charCodeAt((t+r)%o)))}else for(let o=0;o<e.length;o++)n.push(String.fromCharCode(e.charCodeAt(o)^t.charCodeAt(r))),r++,r>t.length-1&&(r=0);return n.join("")}static decrypt(e,{key:t=""}={}){if(!t)throw new Error("key is not set!");let r=0,n=[];if(s){let r=0,o=e.length;for(let e=0;e<t.length;e++)r+=t.charCodeAt(e);r%=o,r=o-r;for(let t=0;t<e.length;t++)n.push(String.fromCharCode(e.charCodeAt((t+r)%o)))}else for(let o=0;o<e.length;o++)n.push(String.fromCharCode(e.charCodeAt(o)^t.charCodeAt(r))),r++,r>t.length-1&&(r=0);return n.join("")}}var h=r("L0gU");class u{static makeCallbackRequest(e,t,r,n=""){e.onsuccess=t,e.onerror=r}static makePromiseRequest(e){return new Promise(((t,r)=>{e.onsuccess=t,e.onerror=r}))}static convertoArray(e){return(null==e?void 0:e.constructor)===Array?e:[e]}static getDbErrorCode(e){var t,r,n,o;return e?(null==e?void 0:e.code)?e.code:null!=(null==e||null===(t=e.target)||void 0===t||null===(r=t.error)||void 0===r?void 0:r.code)?e.target.error.code:null!=(null==e||null===(n=e.currentTarget)||void 0===n||null===(o=n.error)||void 0===o?void 0:o.code)?e.currentTarget.error.code:-1:-1}static getDbErrorName(e){var t,r,n,o;return e?(null==e?void 0:e.name)?e.name:null!=(null==e||null===(t=e.target)||void 0===t||null===(r=t.error)||void 0===r?void 0:r.name)?e.target.error.name:null!=(null==e||null===(n=e.currentTarget)||void 0===n||null===(o=n.error)||void 0===o?void 0:o.name)?e.currentTarget.error.name:"unknown":"unknown"}static getDbErrorMessage(e){var t,r,n,o,s,i,a,l;return e?e&&"string"==typeof e?e:(null==e?void 0:e.message)?e.message:(null==e||null===(t=e.target)||void 0===t||null===(r=t.error)||void 0===r?void 0:r.message)?e.target.error.message:(null==e||null===(n=e.currentTarget)||void 0===n||null===(o=n.error)||void 0===o?void 0:o.message)?e.currentTarget.error.message:(null==e||null===(s=e.target)||void 0===s||null===(i=s.error)||void 0===i?void 0:i.name)?e.target.error.name:(null==e||null===(a=e.currentTarget)||void 0===a||null===(l=a.error)||void 0===l?void 0:l.name)?e.currentTarget.error.name:"unknown":"unknown"}static parseErrorInfo(e){return{code:u.getDbErrorCode(e),message:u.getDbErrorMessage(e),name:u.getDbErrorName(e)}}static decrypt(e,...t){return JSON.parse(l.decrypt(e,...t))}static encrypt(e,...t){return l.encrypt(JSON.stringify(e),...t)}}const c=()=>{},d=()=>Promise.reject("not_impl"),f=()=>{throw Error("not_impl")};class m{constructor(e,t,r,n="store",{realName:o,defer:s}={}){this.env=e;let{createRange:i,transformer:a}=e;this.createRange=i||f,this.transformer=a,this.type=n,this._store=r,this._storeName=t,this._realName=o||t,this.indexs={}}get name(){return this._storeName}_transFromDBToUI(e,{raw:t=!1}={}){return t?e:this.transformer.fromDBtoUI(e,{storeName:this._storeName})}_transFromUIToDB(e,{raw:t=!1}={}){return t?e:this.transformer.fromUItoDB(e,{storeName:this._storeName})}countAll(){return this.count()}addOrUpdate(e){return this.put(e)}delete(e){return this.remove(e)}addRaw(e){return this.add(e,{raw:!0})}get indexNames(){var e;return(null===(e=this._store)||void 0===e?void 0:e.indexNames)||[]}index(e){return f()}count(){return d()}get(e,{raw:t=!1}={}){return d()}getKey(e){return d()}getAll(e,t){return d()}getAllKeys(e,t){return d()}openCursor(e,t,{shouldStop:r=c,onValue:n=c}={},{raw:o=!1,maxLoop:s=1e4,advance:i=null,stepCount:a=null}={}){return d()}openKeyCursor(e,t,{shouldStop:r=c,onValue:n=c}={},{maxLoop:o=1e4,primaryKey:s=!1}={}){return d()}clear(){return d()}getByRange(e,t){return d()}add(e,{raw:t=!1}={}){return d()}put(e){return d()}remove(e){return d()}getKeys({range:e,limit:t,direction:r=h.e.NEXT}={},n){return d()}getObjects({range:e,limit:t,direction:r=h.e.NEXT,predicate:n,isAbort:o=null}={},s){return d()}}const _=()=>{},p=()=>{throw Error("not_impl")},g={resolve:_,reject:_};class v{constructor(e){this.env=e;let{transformer:t,createRange:r,debug:n,controller:o,errorHandler:s}=e||{};this.active=!0,this.createRange=r||p,this.transformer=t,this.run=this.run.bind(this),this._handler={},Object.values(h.b).forEach((e=>{let t=`_impl${e}`;this[t]?this._handler[e]=this[t].bind(this):this._handler[e]=this._notImpl.bind(this)})),this.controller=o,this.errorHandler=s,this.storeWrapper=m}run(e){return new Promise(((t,r)=>{if((null==e?void 0:e.constructor)!==h.a)return this.errorHandler({job:e,message:"invalid_job_item"}),r({message:"invalid_job_item"});this.controller.addJob(e,{onExecute:()=>{this._run(e).then(t).catch((e=>{this.errorHandler(e),r(e)}))},onAbort:(t="abort")=>{e.error(t),r(t),this.errorHandler({job:e,message:"abort"})}})}))}_run(e){return new Promise(((t,r)=>this.active?(this.__log("run job: at store:",e.options.params[0]," action: ",e.method,e),this._handler[e.method]?void this._handler[e.method](...e.options.params).then((r=>{e.success(r),t(r)})).catch((t=>{e.error(t),r(t)})):(e.error({message:"invalid_method_"+e.method}),r({message:"invalid_method_"+e.method}))):(r({message:"impl_is_deactive"}),e.error({message:"impl_is_deactive"}))))}destroy(){this.active=!1}setExecutor(e){this.db=e}_notImpl(){return Promise.reject("not_impl")}__log(...e){var t;(null===(t=this.env)||void 0===t?void 0:t.debug)&&console.log("ImplHandler:",...e)}__lockStore(e){if(!e)throw Error("invalid storeInfo "+e);if("string"==typeof e)return e;if(null==e?void 0:e.store)return e.store;throw Error("invalid storeInfo "+e)}__getStores(e){return(null==e?void 0:e.constructor)===Array?e.map((e=>this.__lockStore(e))):[this.__lockStore(e)]}__getTrans(e,t,{resolve:r,reject:n}){let o={getObjectStore:()=>p()};return o}__prepare(e,t,{resolve:r,reject:n}){let o,s;if(o=this.__getTrans(e,t,{resolve:r,reject:n}),!o)throw Error("invalid_trans");if(s=this.__wrapperStore(e,o,{resolve:r,reject:n}),!s)throw Error("invalid_storeObj");return{storeObj:s}}__prepareMulti(e,t,{resolve:r,reject:n}){let o,s={};return o=this.__getTrans(e,t,{resolve:r,reject:n}),s=e.map((e=>this.__wrapperStore(e,o,{resolve:r,reject:n}))),{storeObjs:s}}__wrapperStore(e,t,r){let n,o;if(!e)throw Error("invalid_storeInfo_undefined");if("string"==typeof e){let s=e;o=t.getObjectStore(s),n=new this.storeWrapper(this.env,s,o,"store",{defer:r})}else if("object"==typeof e&&e.store){let s=e.store,i=e.index;o=t.getObjectStore(s),n=new this.storeWrapper(this.env,s,o,"store",{defer:r}),i&&(n=n.index(i))}return n}_implget(e,t,r){return new Promise(((n,o)=>{if(!t)return o({name:"INVALID_INPUT",message:"INVALID_OBJECT_IMPL_GET_"+t});const{storeObj:s}=this.__prepare(e,h.h.READONLY,g);if(t.constructor===Array){const e={},r=t.map((t=>this._safeGetObjectById(s,t).then((r=>{r&&(e[t]=r)}))));Promise.all(r).then((()=>n(e)))}else n(s.get(t,r))}))}_implgetByIds(e,t){return new Promise(((r,n)=>{if(!t||!t.length)return n({name:"INVALID_INPUT",message:"INVALID_OBJECT_IMPL_GETBYIDS_"+t});const{storeObj:o}=this.__prepare(e,h.h.READONLY,g),s=t.map((e=>this._safeGetObjectById(o,e)));Promise.all(s).then((e=>{r(e.filter(Boolean))}))}))}_impladd(e,t){return new Promise(((r,n)=>{if(!t)return Promise.reject({name:"INVALID_INPUT",message:"INVALID_OBJECT_IMPL_ADD_"+t});let o={resolve:r,reject:n},{storeObj:s}=this.__prepare(e,h.h.READWRITE,o);if(t.constructor===Array)for(let e=0;e<t.length;e++)s.add(t[e]);else s.add(t)}))}_implgetAll(e,t,r,n,o){return new Promise(((s,i)=>{let a=[],l={resolve:e=>{s(a)},reject:i},{storeObj:u}=this.__prepare(e,h.h.READONLY,l),c=this.createRange(t);u.openCursor(c,n,{shouldStop:()=>r&&a.length>=r,onValue:e=>{a.push(e)},opts:o}).then((()=>{l.resolve()})).catch(i)}))}_impladdIfNotExists(e,t){return new Promise(((r,n)=>{let o=[],s=[],i={resolve:e=>{r({success:o,fail:s,e:e})},reject:n},{storeObj:a}=this.__prepare(e,h.h.READWRITE,i),l=u.convertoArray(t);for(let e=0;e<l.length;e++){const t=l[e];a.add(t).then((()=>{o.push(t)})).catch((e=>{if(e&&e.stopPropagation&&e.preventDefault)try{e.stopPropagation(),e.preventDefault()}catch(e){}s.push(t)}))}}))}_implremove(e,t){return new Promise(((r,n)=>{let o={resolve:r,reject:n},{storeObj:s}=this.__prepare(e,h.h.READWRITE,o),i=u.convertoArray(t);for(let e=0;e<i.length;e++){const t=i[e];s.delete(t)}}))}_impladdOrUpdate(e,t){return new Promise(((r,n)=>{let o={resolve:r,reject:n},{storeObj:s}=this.__prepare(e,h.h.READWRITE,o),i=u.convertoArray(t);for(let e=0;e<i.length;e++){const t=i[e];s.put(t)}}))}_implupdateItem(e,t,r){return new Promise(((n,o)=>{let s={resolve:n,reject:o},{storeObj:i}=this.__prepare(e,h.h.READWRITE,s);i.get(t).then((e=>{if(!e)return o({name:"NOT_FOUND",message:"NOT_FOUND_ITEM_UPDATE_ITEM"});r(e),i.put(e)})).catch(o)}))}_implupdateAttrs(e,t,r,n){return new Promise(((o,s)=>{let i={resolve:o,reject:s},{storeObj:a}=this.__prepare(e,h.h.READWRITE,i);a.get(t).then((e=>{if(!e)return s({name:"NOT_FOUND",message:"NOT_FOUND_ITEM_UPDATE_ATTRS"});r.forEach((t=>{e[t]=n[t]})),a.put(e)})).catch(s)}))}_implclearStore(e){return new Promise(((t,r)=>{let n={resolve:t,reject:r},{storeObj:o}=this.__prepare(e,h.h.READWRITE,n);o.clear()}))}_implrunTransaction(e,t,r){return new Promise(((n,o)=>{let s={resolve:n,reject:o},{storeObjs:i}=this.__prepareMulti(e,r,s);t(i)}))}_implcount(e){return new Promise(((t,r)=>{let n={resolve:t,reject:r},{storeObj:o}=this.__prepare(e,h.h.READONLY,n);t(o.count())}))}_safeGetObjectById(e,t){return e.get(t).catch((()=>{}))}}const E=()=>{};class I extends m{constructor(...e){super(...e)}get indexNames(){var e;return(null===(e=this._store)||void 0===e?void 0:e.indexNames)||[]}index(e){if("store"!==this.type)throw Error("only call index from store");if(this.indexs[e])return this.indexs[e];let t=this._store.index(e),r=new I(this.env,this._storeName,t,"index",{realName:e,defer:this.defer});return this.indexs[e]=r,this.indexs[e]}countAll(){return this.count()}addOrUpdate(e){return this.put(e)}delete(e){return this.remove(e)}addRaw(e){return this.add(e,{raw:!0})}count(){return new Promise(((e,t)=>{let r=this._store.count();u.makePromiseRequest(r).then((()=>{isNaN(r.result)?t({name:"INVALID_RESP",message:"INVALID_COUNT_RESP",r:r}):e(+r.result)})).catch(t)}))}get(e,{raw:t=!1}={}){return new Promise(((r,n)=>{if(!e)return n({name:"INVALID_INPUT",message:"INVALID_OBJECT_ID_GET_"+e});let o=this._store.get(e);u.makePromiseRequest(o).then((()=>{let e=this._transFromDBToUI(null==o?void 0:o.result,{raw:t});r(e)})).catch(n)}))}getKey(e){return new Promise(((t,r)=>{if(!e)return r({name:"INVALID_INPUT",message:"INVALID_OBJECT_ID_GETKEY_"+e});let n=this._store.getKey(e);u.makePromiseRequest(n).then((()=>{t(null==n?void 0:n.result)})).catch(r)}))}getAll(e,t){return new Promise(((r,n)=>{let o=this.createRange(e),s=this._store.getAll(o,t);u.makePromiseRequest(s).then((()=>{let e=this._transFromDBToUI(null==s?void 0:s.result);r(e)})).catch(n)}))}getAllKeys(e,t){return new Promise(((r,n)=>{let o=this.createRange(e),s=this._store.getAllKeys(o,t);u.makePromiseRequest(s).then((()=>{r(null==s?void 0:s.result)})).catch(n)}))}openCursor(e,t,{shouldStop:r=E,onValue:n=E}={},{raw:o=!1,maxLoop:s=1e4,advance:i=null,stepCount:a=null}={}){return new Promise(((l,h)=>{let c=this.createRange(e),d=this._store.openCursor(c,t),f=0,m=!!i;u.makeCallbackRequest(d,(e=>{let t=e.target.result;if(!t)return l();if(m&&i)return m=!1,t.advance(i);let h=this._transFromDBToUI(t.value,{raw:o});return n(h,t),r(h)?l():(f++,f>=s?l({name:"AVOID_LOOP_ALL_DB",message:"loop_"+s+"_time",lastItem:h}):void(a?t.advance(a):t.continue()))}),h)}))}openKeyCursor(e,t,{shouldStop:r=E,onValue:n=E}={},{maxLoop:o=1e4,primaryKey:s=!1}={}){return new Promise(((i,a)=>{let l=this.createRange(e),h=this._store.openKeyCursor(l,t),c=0;u.makeCallbackRequest(h,(e=>{let t=e.target.result;if(!t)return i();let a=s?t.primaryKey:t.key;return n(a),r(a)?i():(c++,c>=o?i({name:"AVOID_LOOP_ALL_DB",message:"loop_"+o+"_time",lastItem:t.key}):void t.continue())}),a)}))}clear(){return new Promise(((e,t)=>{e(u.makePromiseRequest(this._store.clear()))}))}getByRange(e,t){return new Promise(((r,n)=>{let o=this.createRange(e),s=[];this.openCursor(o,h.e.PREV,{shouldStop:()=>!1,onValue:e=>{s.push(e)}},t).then((()=>{r(s)})).catch(n)}))}add(e,{raw:t=!1}={}){return new Promise(((r,n)=>{let o=this._transFromUIToDB(e,{raw:t}),s=this._store.add(o);u.makePromiseRequest(s).then(r).catch(n)}))}put(e){return new Promise(((t,r)=>{let n=this._transFromUIToDB(e),o=this._store.put(n);u.makePromiseRequest(o).then(t).catch(r)}))}remove(e){return new Promise(((t,r)=>{let n=this._store.delete(e);u.makePromiseRequest(n).then(t).catch(r)}))}getKeys({range:e,limit:t,direction:r=h.e.NEXT}={},n){return new Promise(((o,s)=>{let i=this.createRange(e),a=[];this.openKeyCursor(i,r,{shouldStop:()=>t&&a.length>=t,onValue:e=>{a.push(e)}},n).then((()=>{o(a)})).catch(s)}))}getObjects({range:e,limit:t,direction:r=h.e.NEXT,predicate:n,isAbort:o=null}={},s){return new Promise(((i,a)=>{n&&"function"==typeof n||(n=()=>!0),o&&"function"==typeof o||(o=()=>!1);let l=this.createRange(e),h=[];this.openCursor(l,r,{shouldStop:()=>!!(t&&h.length>=t)||!!o(),onValue:e=>{n(e)&&h.push(e)}},s).then((()=>{i(h)})).catch(a)}))}}class y extends v{constructor(...e){super(...e),this.storeWrapper=I}__getTrans(e,t,{resolve:r,reject:n}){let o,s=this.__getStores(e);if(!this.db)throw Error(`DB_INSTANCE_INVALID_TO_GET_STORES_${s.join(",")}`);let i=s.filter((e=>!this.db.objectStoreNames.contains(e)));if(i.length)throw Error(`DB_MISS_STORES_${i.join(",")}`);return o=this.db.transaction(s,t),o.getObjectStore=e=>{var t;if(!o||!(null===(t=o.objectStoreNames)||void 0===t?void 0:t.contains(e)))throw Error(`DB_TRANS_INVALID_IN_GET_STORE_${e}`);return o.objectStore(e)},o.oncomplete=r,o.onabort=n,o.onerror=n,o}}class b{constructor(e,t){this.config={},this.env=e,this.storeItemAbstract=t||{}}setDecryptKey(e=""){this.config.UIN=e}fromUItoDB(e,{storeName:t=""}={}){if(t&&this.storeItemAbstract[t]){if((null==e?void 0:e.constructor)===Array){return e.map((e=>this.storeItemAbstract[t].fromUI(e,this.config).toDB()))}return this.storeItemAbstract[t].fromUI(e,this.config).toDB()}return e}fromDBtoUI(e,{storeName:t=""}={}){if(t&&this.storeItemAbstract[t]){if((null==e?void 0:e.constructor)===Array){return e.map((e=>this.storeItemAbstract[t].fromDB(e,this.config).toUI()))}return this.storeItemAbstract[t].fromDB(e,this.config).toUI()}return e}}const D=()=>{};class T{constructor(){this._queue=[]}doneJob(e){this._wakeQueue()}addJob(e,{onExecute:t=D,onAbort:r=D}={}){if((null==e?void 0:e.constructor)!==h.a)throw Error("job isnt valid");let n={job:e,onExecute:t,onAbort:r};this._addJob(n),this._wakeQueue()}_addJob(e){this._queue.push(e)}_wakeQueue(){if(!this._queue.length)return;this._queue.shift().onExecute()}}const w={ERR:{UNKNOWN:-1,ABORT_ERR:20,DATA_CLONE_ERR:25,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,INDEX_SIZE_ERR:1,INUSE_ATTRIBUTE_ERR:10,INVALID_ACCESS_ERR:15,INVALID_CHARACTER_ERR:5,INVALID_MODIFICATION_ERR:13,INVALID_NODE_TYPE_ERR:24,INVALID_STATE_ERR:11,NAMESPACE_ERR:14,NETWORK_ERR:19,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,QUOTA_EXCEEDED_ERR:22,SECURITY_ERR:18,SYNTAX_ERR:12,TIMEOUT_ERR:23,TYPE_MISMATCH_ERR:17,URL_MISMATCH_ERR:21,VALIDATION_ERR:16,WRONG_DOCUMENT_ERR:4},MSG:{CLOSE_DB:["Failed to execute 'transaction' on 'IDBDatabase': The database connection is closing.","The connection was closed."],OUT_MEM:["Version change transaction was aborted in upgradeneeded event handler."]},ERR_NAME:{INVALID_VERSION:["VersionError","VersionChange"]}},O=Object.freeze({DB_ERROR:1,DB_LOG:2,DB_EVENT:3});var R=new class{constructor(){this.EventType=O,this._holdEvents={},Object.values(O).forEach((e=>{this._holdEvents[e]=[]}))}listen(e,t){return!!this._holdEvents[e]&&(this._holdEvents[e].push(t),!0)}remove(e,t){if(!this._holdEvents[e])return!1;let r=!1;for(let n=this._holdEvents[e].length-1;n>=0;n--)this._holdEvents[e][n]===t&&(this._holdEvents[e].splice(n,1),r=!0);return r}fire(e,t=[]){if(this._holdEvents[e]){for(let r=0;r<this._holdEvents[e].length;r++){let n=this._holdEvents[e][r];t||(t=[]),t.constructor!==Array&&(t=[t]),setTimeout((()=>{n(...t)}),0)}return!0}}};const S=[[1,Number.MIN_SAFE_INTEGER,1e3],[2,1001,5e3],[3,5001,1e4],[4,10001,15e3],[5,15001,2e4],[6,20001,Number.MAX_SAFE_INTEGER]];class N{constructor(e,t){this.dbName=e,this.env=t,this.config={numberRetryOpenIn1Hour:0,markFirstTimeRetry:0}}_buildEvent(e,t={}){return{type:e,dbName:this.dbName,info:t}}_logQos({success:e,commandId:t,duration:r=0,errorCode:n=-1,startTime:o}={}){null!=e&&null!=t&&R.fire(R.EventType.DB_LOG,[this._buildEvent("DB_LOG_QOS",{success:e,commandId:t,duration:r,errorCode:n,startTime:o})])}reopen(){let e=Date.now();Math.abs(e-this.config.markFirstTimeRetry)>=36e5?(this.config.markFirstTimeRetry=e,this.config.numberRetryOpenIn1Hour=1):this.config.numberRetryOpenIn1Hour++}canReopen(){var e;return!!(null===(e=this.env.meta.reopen)||void 0===e?void 0:e.maxTimes)&&this.config.numberRetryOpenIn1Hour<=this.env.meta.reopen.maxTimes}stopReopen(){R.fire(R.EventType.DB_ERROR,[this._buildEvent("DB_REOPEN_TOOMUCH")])}outOfDisk(){R.fire(R.EventType.DB_ERROR,[this._buildEvent("DB_OUT_OF_DISK")])}dbMissStores(){R.fire(R.EventType.DB_ERROR,[this._buildEvent("DB_MISS_STORE")])}clearTrackOpenDBTimer(){this._lrrTimer&&(clearTimeout(this._lrrTimer),this._lrrTimer=null)}invalidVersion({code:e,name:t,message:r}){R.fire(R.EventType.DB_ERROR,[this._buildEvent("DB_INVALID_VERSION")])}startTrackOpenDB(e){this._lrrTimer&&this.error("WARNING: there is already a running open db request. It's going to be cleared."),this.clearTrackOpenDBTimer(),this._lrrTimer=setTimeout((()=>{this.clearTrackOpenDBTimer(),this.error("WARNING: The open indexedDb request has run for 20 sec."),this.logQosOpenDbSuccess(e)}),2e4)}logQosOpenDbSuccess(e){var t,r;if(this.clearTrackOpenDBTimer(),!(null===(t=this.env.meta)||void 0===t||null===(r=t.openSuccess)||void 0===r?void 0:r.cmd))return;const n=Date.now();setTimeout((()=>{const t=n-e,[r]=S.find((([e,r,n])=>t<=n&&t>=r))||[-1],o={success:!1,commandId:this.env.meta.openSuccess.cmd,subCommandId:0,duration:t,errorCode:r,startTime:e};this._logQos(o)}),1e3)}dbError(e){var t,r;if(null===(t=this.env.meta)||void 0===t||null===(r=t.dbError)||void 0===r?void 0:r.cmd)if(this.config.dbErrorCount>10){if(this.config.dbErrorResetTimer)return;this.config.dbErrorResetTimer=setTimeout((()=>{this.config.dbErrorResetTimer=null,this.config.dbErrorCount=0}))}else this.config.dbErrorCount++,this._logQos({success:!1,commandId:this.env.meta.dbError.cmd,duration:0,errorCode:e,startTime:Date.now()})}logQos({success:e,commandId:t,duration:r,errorCode:n,startTime:o}={}){this._logQos({success:e,commandId:t,duration:r,errorCode:n,startTime:o})}error(e){R.fire(R.EventType.DB_LOG,[this._buildEvent("ERROR",e)])}info(e){R.fire(R.EventType.DB_LOG,[this._buildEvent("INFO",e)])}log(e){R.fire(R.EventType.DB_LOG,[this._buildEvent("LOG",e)])}}const A={INIT:1,OPENING:2,OPENED:3,CLOSING:4,CLOSED:5};class C{constructor(e,t){this.name=t,this.container=e,Object.values(h.b).forEach((r=>{this[r]=(...n)=>e[r](t,...n)}))}index(e){let t=this;if("string"!=typeof t.name)throw Error("chỉ support call index trên store!!");return new C(t.container,{store:t.name,index:e})}}const x=e=>{setTimeout(e,0)},P=new Set(["NOT_FOUND"]);class k extends class{constructor(e){var t,r;this.env=e;let{suffix:n,dbNamePrefix:o,dbVersion:s,dbConfig:i,transformer:a,controller:l}=e;this.dbSessionConfig={},this.suffix=n,this.dbNamePrefix=o,this.dbVersion=s,this.dbConfig=i||{},this.transformer=a||new b(e),this.controller=l||new T(e),this.STATE=A,this._currentState=A.INIT,this._enable=!0,Object.values(h.b).forEach((e=>{this[e]=(...t)=>new Promise(((r,n)=>{this._addJob(new h.a(t[0],e,{params:t},{resolve:r,reject:n}))}))})),this._pending=[],this.implHandler=new v({controller:l,errorHandler:this._handleDbError.bind(this)}),this.errorController=new N(this.dbNamePrefix,this.env),this._store={},(null===(t=this.dbConfig)||void 0===t||null===(r=t.stores)||void 0===r?void 0:r.length)&&this.dbConfig.stores.forEach((e=>{e&&e.name&&(this._store[e.name]=new C(this,e.name))})),this._onCloseUnexpected=this._onCloseUnexpected.bind(this),this.__stats={open:0,opened:0}}isValidToOpen(){return this.isActive()&&this._currentState===A.OPENING}isActive(){return this._enable}destroy(){this._enable=!1,this.implHandler.destroy(),this.close()}isReady(){return this.isActive()&&this._currentState==A.OPENED}store(e){return this._store[e]||(this._store[e]=new C(this,e)),this._store[e]}_increaseReopenTime(){let e=Date.now();Math.abs(e-this.errorConfig.markFirstTimeRetry)>=36e5?(this.errorConfig.markFirstTimeRetry=e,this.errorConfig.numberRetryOpenIn1Hour=1):this.errorConfig.numberRetryOpenIn1Hour++}reopen(){return this.dbName?this._open({reopen:!0}):Promise.reject("call reopen! but not open yet!!")}setSession(e,t){this.dbSessionConfig={suffixName:e,UIN:t},this.transformer.setDecryptKey(t)}open(e,t){return new Promise(((r,n)=>{let o;if(this.suffix){if(!e)throw Error(`DB : [${this.dbNamePrefix}${e}] không valid`);o=this.dbNamePrefix+e}else{if(e)throw Error(`DB : này có tên cố định là ${this.dbNamePrefix} không truyền tên khác (${e}) vào!`);o=this.dbNamePrefix}if(!o)throw Error(`DB: invalid dbName [${o}]`);this.dbName&&r(this.db),this.setSession(e,t),this.dbName=o,r(this._open())}))}close(){this._currentState==A.OPENED&&(this._doCloseDB(),this._changeState(A.CLOSED),this._onCloseDB())}delete(){return this.destroy(),this._doDeleteDB()}_open({reopen:e=!1}={}){let t="";if(!this.isActive())return t=`FAIL_TO_OPEN_${this.dbName}_IN_${__ZaBUNDLENAME__}`,this.errorController.error(t),Promise.reject(t);if(this._currentState===A.INIT||this._currentState==A.CLOSED||this._currentState==A.CLOSING){if(e){if(!this.errorController.canReopen())return this.errorController.stopReopen(),Promise.reject("reopen too much");this.errorController.reopen()}return this._openDb()}return t=`FAIL_TO_OPEN_INVALID_STATE_${this._currentState}`,this.errorController.error(t),Promise.reject(t)}_executePending(){if(!this.isReady())return;this.__pendingExecuteTooLong&&(clearTimeout(this.__pendingExecuteTooLong),this.__pendingExecuteTooLong=null);let e=this._pending,t=e.length;this._pending=[];for(let r=0;r<t;r++)this.implHandler.run(e[r])}_addJob(e){this.isActive()?this.isReady()?(this._pending.length&&this._executePending(),this.implHandler.run(e)):(this._pending.push(e),this.__pendingExecuteTooLong||(this.__pendingExecuteTooLong=setTimeout((()=>{this.errorController.error(`PENDING TOO LONG ${this._pending.length}`)}),2e4))):e&&e.error("DB_IS_DISABLE")}_changeState(e){this._currentState=e}_overrideOpenDb(){return new Promise(((e,t)=>t("not impl")))}_openDb(){this.errorController.info(`start open DB ${this.dbName}`),this._changeState(A.OPENING);const e=Date.now();return this.errorController.startTrackOpenDB(e),this.__stats.open++,this._overrideOpenDb().then((t=>{this.errorController.logQosOpenDbSuccess(e),this._changeState(A.OPENED),this.implHandler.setExecutor(t),this._executePending(),this._onOpenDB()})).catch((e=>{throw this._changeState(A.CLOSED),this.errorController.clearTrackOpenDBTimer(),this._onCloseDB(),e}))}_doCloseDB(){}_doDeleteDB(){}_onCloseDB(){}_onOpenDB(){this.errorController.info(`open DB ${this.dbName} success`),this.__stats.opened++,R.fire(R.EventType.DB_EVENT,[this.__buildEvent("DB_OPENED_SUCCESS",{times:this.__stats.opened})])}_onCloseUnexpected(){this.isActive()&&(this._changeState(A.CLOSED),this._maybeRestart())}_maybeRestart(){this.isActive()}_onUpgradeDB(){}_handleDbError(e){}__buildEvent(e,t={}){return{type:e,dbName:this.dbName,info:t,state:this._currentState}}__createErr({message:e}){return{message:e,src:"DB",dbName:this.dbName,state:this._currentState}}}{constructor(){super(...arguments),this.indexedDB=indexedDB,this.IDBKeyRange=IDBKeyRange,this.IDBDatabase=IDBDatabase,this.createRange=this.createRange.bind(this),this.implHandler=new y({indexedDB:indexedDB,IDBKeyRange:IDBKeyRange,IDBDatabase:IDBDatabase,createRange:this.createRange,transformer:this.transformer,controller:this.controller,debug:!0,errorHandler:this._handleDbError.bind(this)})}createRange(e){if(!e)return e;if(e.constructor===this.IDBKeyRange)return e;e.constructor===h.c&&(e=e.toJSON()),e.constructor===Array&&(e={low:e[0],high:e[1],excludeLow:!!e[2],excludeHigh:!!e[3]});let{low:t,high:r,excludeLow:n=!1,excludeHigh:o=!1,only:s=!1}=e||{};return s?this.IDBKeyRange.only(t):null!=t&&null!=r?this.IDBKeyRange.bound(t,r,n,o):null!=t?this.IDBKeyRange.lowerBound(t,n):null!=r?this.IDBKeyRange.upperBound(r,o):null}_idbValidDb(){var e;return(null===(e=this.db)||void 0===e?void 0:e.constructor)===this.IDBDatabase}_idbQosMissStore(e){var t,r;if(!this.__ranIdbQosMissStore&&(this.__ranIdbQosMissStore=!0,(null===(t=this.env.meta)||void 0===t||null===(r=t.storesVerify)||void 0===r?void 0:r.cmd)&&(null==e?void 0:e.objectStoreNames))){var n,o,s;let t=0;if(null===(n=this.dbConfig.stores)||void 0===n||n.forEach(((r,n)=>{(null==r?void 0:r.name)&&(e.objectStoreNames.contains(r.name)||(t+=1<<n))})),0==t)return;const r={success:!1,commandId:null===(o=this.env.meta)||void 0===o||null===(s=o.storesVerify)||void 0===s?void 0:s.cmd,subCommandId:0,duration:0,errorCode:t,startTime:Date.now()};this.errorController.logQos(r)}}_idbVerifyDB(e){var t,r;if(!(null===(t=this.env.meta)||void 0===t||null===(r=t.storesVerify)||void 0===r?void 0:r.stores))return!0;if(null==e?void 0:e.objectStoreNames){var n,o;let t=null===(n=this.env.meta)||void 0===n||null===(o=n.storesVerify)||void 0===o?void 0:o.stores;if(this._idbQosMissStore(e),t.find((t=>!e.objectStoreNames.contains(t))))return this.destroy(),this.errorController.dbMissStores(),!1}return!0}_doCloseDB(){this._idbValidDb()&&this.db.close(),this.db=null}_overrideOpenDb(){return new Promise(((e,t)=>{let r=this.indexedDB.open(this.dbName,this.dbVersion);r.onblocked=e=>{t(e),x((()=>{this._handleDbError(e,"ON_OPEN_BLOCK")}))},r.onerror=e=>{t(e),x((()=>{this._handleDbError(e,"ON_OPEN_ERROR")}))},r.onsuccess=r=>this.isValidToOpen()?this._idbVerifyDB(r.target.result)?(this.db=r.target.result,this.db.onclose=this._onCloseUnexpected,this.db.onversionchange=e=>{this.close(),this.errorController.error("DB is onpen and upgrade in another tab => close to upgrade"),window.location.reload()},void e(this.db)):(r.target.result.close(),t(this.__createErr({message:"DB_MISS_IMPORTANT_STORES"}))):(r.target.result.close(),t(this.__createErr({message:"DB_IS_NOT_ENABLE"}))),r.onupgradeneeded=e=>{var r,n;if(!this.isValidToOpen())return null==e||null===(r=e.target)||void 0===r||null===(n=r.transaction)||void 0===n||n.abort(),t(this.__createErr({message:"DB_IS_NOT_ENABLE"}));this._onUpgrade(e.target.result,e.target.transaction)}}))}_onUpgrade(e,t){var r,n;if(null===(r=this.dbConfig)||void 0===r||null===(n=r.stores)||void 0===n?void 0:n.length){const r=(e,t)=>{var r;e&&(null==t||null===(r=t.index)||void 0===r?void 0:r.length)&&t.index.forEach((t=>{var r;(null==t?void 0:t.name)&&(null==t?void 0:t.attr)&&(null==t?void 0:t.opts)&&((null==e||null===(r=e.indexNames)||void 0===r?void 0:r.contains(t.name))||e.createIndex(t.name,t.attr,t.opts))}))};this.dbConfig.stores.forEach((n=>{if(!(null==n?void 0:n.name)||!(null==n?void 0:n.opts))return;let o;if(e.objectStoreNames.contains(n.name))return o=t.objectStore(n.name),void r(o,n);o=e.createObjectStore(n.name,n.opts),r(o,n),"function"==typeof n.fAfterCreate&&n.fAfterCreate(o)}))}}_doDeleteDB(){return new Promise(((e,t)=>{if(!this.dbName)return t("invalid_db_name");const r=setTimeout((()=>{this.errorController.error("DELETE_DB_TIMEOUT"),t({message:"DELETE_DB_TIMEOUT"})}),1e4);let n=this.indexedDB.deleteDatabase(this.dbName);u.makePromiseRequest(n).then((()=>{clearTimeout(r),e()})).catch((e=>{clearTimeout(r),t(e)}))}))}_handleDbError(e,t){let{code:r,message:n,name:o}=u.parseErrorInfo(e);if(o&&P.has(o)?this.errorController.info(`${t?`[${t}]`:""}[${r}][${o}][${n}]`):this.errorController.error(`${t?`[${t}]`:""}[${r}][${o}][${n}]`),isNaN(+r)||this.errorController.dbError(+r),w.ERR_NAME.INVALID_VERSION.includes(o))return this.errorController.error("_handleDbError invalid version => update"),void this.errorController.invalidVersion({code:r,message:n,name:o});switch(r){case w.ERR.QUOTA_EXCEEDED_ERR:return void this.errorController.outOfDisk({code:r,message:n});case w.ERR.ABORT_ERR:return this.errorController.error("_handleDbError ABORT_ERR ",e),void(w.MSG.OUT_MEM.includes(n)&&this.errorController.outOfDisk({code:r,message:n}));case w.ERR.INVALID_STATE_ERR:return void(w.MSG.CLOSE_DB.includes(n)&&(this.errorController.error("_handleDbError INVALID_STATE_ERR need restart",e),this.close(),this.reopen()))}return"ON_OPEN_ERROR"===t||"ON_OPEN_BLOCK"===t?(this.errorController.error(`_handleDbError open db error ${t} need restart [${o}][${n}][${r}]`),this.close(),void this.reopen()):void 0}}class B extends k{constructor(...e){super(...e),this.__getAllMessageFrom=this.__getAllMessageFrom.bind(this)}getLastChatMessage(e,t){}loadTopMessage(e,t,r){}loadBottomMessage(e,t,r){}getLastMessageFrom(e,t,r,n=50,o=!0){return new Promise(((s,i)=>{if(!e||!r||!t)return i({error:"Invalid params"});const a=new h.c({low:[e,t.sendDttm+"",t.msgId],high:[e,r.sendDttm+"",r.msgId],excludeLow:!o,excludeHigh:!o});this.__getAllMessageFrom(n,a,h.e.PREV,{resolve:s,reject:i})}))}getNextMessageFrom(e,t,r=50,n=!0){return new Promise(((o,s)=>{if(!e||!t)return s({error:"Invalid params"});const i=new h.c({low:[e,t.sendDttm+"",t.msgId],high:[e,h.f.MAX_SENDDTTM_ID,h.f.MAX_MSG_ID],excludeLow:!n,excludeHigh:!n});this.__getAllMessageFrom(r,i,h.e.PREV,{resolve:o,reject:s})}))}__getAllMessageFrom(e,t,r,{resolve:n,reject:o}){this.store(h.g.MESSAGE).index(h.d.MESSAGE_INDEX_SECOND).getAll(t,e,r).then(n).catch(o)}}const L={Core:"core",Qos:"qos",Res:"res",Reaction:"reaction",Meta:"metainfo",Search:"dbsearch"},M={[L.Core]:{suffix:!0,dbNamePrefix:"zdb_",dbVersion:44,dbConfig:{stores:[{name:"conversation",opts:{keyPath:"userId"}},{name:"friend",opts:{keyPath:"userId"}},{name:"group",opts:{keyPath:"userId"}},{name:"group_info",opts:{keyPath:"userId"}},{name:"avatar",opts:{keyPath:"userId"}},{name:"sticker",opts:{keyPath:["cateId","id"]}},{name:"poll",opts:{keyPath:"poll_id"}},{name:"lan_friend",opts:{keyPath:"uid"}},{name:"lan_add_friend_activities",opts:{keyPath:"sentRequestAt"}},{name:"directory",opts:{keyPath:"uid"}},{name:"notifications",opts:{keyPath:"ts"}},{name:"topic_v2",opts:{keyPath:["groupId","id"]}},{name:"ava_history",opts:{keyPath:"submit_dttm"}},{name:"board_suggest",opts:{keyPath:["groupId","actionId"]}},{name:"download_retry",opts:{keyPath:"url"}},{name:"todo",opts:{keyPath:"id"}},{name:"uploaded_file_thumb",opts:{keyPath:"checksum"}},{name:"cloud_segment",opts:{keyPath:"conversationId"}},{name:"mention",opts:{keyPath:"msgId"}},{name:"star_message",opts:{keyPath:"msgId"},index:[{name:"staredDttm",attr:"staredDttm",opts:{unique:!1}}]},{name:"group_notice",opts:{keyPath:"userId"}},{name:"label",opts:{keyPath:"id",autoIncrement:!0},fAfterCreate:e=>{let t=Date.now();[{color:"#DB342E",createTime:t,emoji:"",text:"Khách hàng"},{color:"#EA87FF",createTime:t+1,emoji:"",text:"Gia đình"},{color:"#F5832F",createTime:t+2,emoji:"",text:"Công việc"},{color:"#FFD000",createTime:t+3,emoji:"",text:"Bạn bè"},{color:"#15A85F",createTime:t+4,emoji:"",text:"Trả lời sau"},{color:"#00BAC0",createTime:t+5,emoji:"",text:"Đồng nghiệp"}].forEach((t=>{e.add(t)}))}},{name:"ttlmsg",opts:{keyPath:"globalDelMsgId",unique:!0},index:[{name:"expired",attr:"expired",opts:{unique:!1}}]},{name:"setting",opts:{keyPath:"name",unique:!0}},{name:"message",opts:{keyPath:"msgId"},index:[{name:"userId_sendDttm_msgId",attr:["toUid","sendDttm","msgId"],opts:{unique:!0}},{name:"cliMsgIdIndex",attr:"cliMsgId",opts:{unique:!1}},{name:"status_sendDttm",attr:["status","sendDttm"],opts:{unique:!1}}]},{name:"image",opts:{keyPath:"msgId"},index:[{name:"userId_sendDttm_msgId",attr:["userId","msgId.length","msgId"],opts:{unique:!1}}]},{name:"file",opts:{keyPath:"msgId"},index:[{name:"userId_sendDttm_msgId",attr:["userId","msgId.length","msgId"],opts:{unique:!1}},{name:"sendDttm",attr:"sendDttm",opts:{unique:!1}}]},{name:"link",opts:{keyPath:"msgId"},index:[{name:"userId_sendDttm_msgId",attr:["userId","msgId.length","msgId"],opts:{unique:!1}}]},{name:"group_topics",opts:{keyPath:"conversationId"}}]}},[L.Qos]:{suffix:!1,dbNamePrefix:"zdb_qos",dbVersion:3,dbConfig:{stores:[{name:"qoslogv2",opts:{keyPath:["ts","cmdId","type"]},index:[{name:"ts",attr:"ts",opts:{unique:!1}}]},{name:"actionlog",opts:{autoIncrement:!0}}]}},[L.Res]:{suffix:!1,dbNamePrefix:"zlocalstorage",dbVersion:5,dbConfig:{stores:[{name:"db-stchecksum",opts:{keyPath:"checksum"}},{name:"cocos-res",opts:{keyPath:"path"}},{name:"info-cache",opts:{keyPath:"key"}},{name:"friend-blocked",opts:{keyPath:"key"}},{name:"retry-cache",opts:{keyPath:"key"}}]}},[L.Reaction]:{suffix:!0,dbNamePrefix:"r_db_",dbVersion:4,dbConfig:{stores:[{name:"reaction",opts:{keyPath:"rMsgId"}},{name:"live_emoji",opts:{keyPath:"rType"}},{name:"unread_react",opts:{keyPath:"conversationId"}},{name:"effect_res",opts:{keyPath:"icon"}}]}},[L.Search]:{suffix:!0,dbNamePrefix:"sidx_",dbVersion:1,dbConfig:{stores:[{name:"stcont",opts:{keyPath:"index",autoIncrement:!0},index:[{name:"msgId",attr:"msgId",opts:{unique:!0}}]},{name:"stidx",opts:{keyPath:"index",autoIncrement:!0},index:[{name:"keywordId",attr:"keywordId",opts:{unique:!1}}]},{name:"stkw",opts:{keyPath:"index",autoIncrement:!0},index:[{name:"keyword",attr:"keyword",opts:{unique:!0}}]}]}},[L.Meta]:{suffix:!0,dbNamePrefix:"msginfo_",dbVersion:5,dbConfig:{stores:[{name:"MsgInfo",opts:{keyPath:"msgId"}},{name:"ConvMsgStatus",opts:{keyPath:"userId"}},{name:"unreadInfo",opts:{keyPath:"userId"}},{name:"MsgUrgency",opts:{keyPath:"msgId"},index:[{name:"sendDttm",attr:"sendDttm",opts:{unique:!1}},{name:"conv_msgId",attr:["toUid","msgId"],opts:{unique:!0}}]},{name:"ThreadMsg",opts:{keyPath:"globalMsgId"}},{name:"ThreadHis",opts:{keyPath:"msgId"}},{name:"Quotes",opts:{keyPath:"msgId"},index:[{name:"convId_sendDttm",attr:["convId","sendDttm"],opts:{unique:!1}}]}]}}},j={[L.Core]:{openSuccess:{cmd:91063},dbError:{cmd:91009},storesVerify:{stores:["conversation","message","group","group_info","friend"],cmd:91073}}};class U{static get TYPE(){return L}static _clone(e){return JSON.parse(JSON.stringify(e))}static _builder(e,{transformer:t=b,controller:r=T,rowItem:n={}}={}){let s=M[e],i=function(e){return Object(o.a)({reopen:{maxTimes:2}},e)}(j[e]||{}),a=this._clone(s);return a=Object(o.a)({meta:i},a),Object(o.a)(Object(o.a)({},a),{},{transformer:new t(a,n),controller:new r(a)})}static build(e,t){if(!M[e])throw new Error("not support type "+e);return this._builder(e,t)}}const F=()=>{},V=5e3,G=10;let K=1;class q{constructor({getDB:e,storeName:t,indexStore:r,ZDB:n}={},{firstCheckDelayTime:o=1e4,checkDelayTime:s=36e5,max_item:i={max:1e5,lower:8e4},rollWithValue:a=!1}={},{onStartRoll:l,funcRoll:h,onRollItem:u,onComplete:c}={}){this.enable=!1,this.ZDB=n,this.config={firstCheckDelayTime:o,checkDelayTime:s,max_item:i,rollWithValue:a},this.getDB=e,this.storeName=t,this.indexStore=r,this.handler={funcRoll:h,onStartRoll:l,onRollItem:u,onComplete:c}}getStore(){return this.getDB().store(this.storeName)}stop(){this.enable=!1,this.__flagStartCheck&&(clearTimeout(this.__flagStartCheck),this.__flagStartCheck=null),this.__flagStartFirstCheck&&(clearTimeout(this.__flagStartFirstCheck),this.__flagStartFirstCheck=null)}start(){this.enable||(this.enable=!0,this._startFirstCheck())}_startFirstCheck(){var e;this.__flagStartFirstCheck||(this.__flagStartFirstCheck=setTimeout((()=>{this.__flagStartFirstCheck=null,this.__runCheck()}),null===(e=this.config)||void 0===e?void 0:e.firstCheckDelayTime))}__afterCheck(e){this._startCheck()}__runCheck(){this.__check().then(this.__afterCheck).catch(this.__afterCheck)}_startCheck(){var e;this.__flagStartCheck||(this.__flagStartCheck=setTimeout((()=>{this.__flagStartCheck=null,this.__runCheck()}),null===(e=this.config)||void 0===e?void 0:e.checkDelayTime))}__needRoll(e){var t;let r=null===(t=this.config)||void 0===t?void 0:t.max_item;if(!isNaN(+e)&&e>=r.max){let t=e-r.lower;if(t>=G)return Math.min(t,V)}return 0}__runRoll(e){return new Promise(((t,r)=>{var n;let o=this.getStore();if(!o)return r("invalid_store_2");const s=K++;this.handler.onStartRoll&&this.handler.onStartRoll(s,e);let i=(null===(n=this.handler)||void 0===n?void 0:n.onRollItem)||F;if(this.handler.funcRoll)return t(this.handler.funcRoll(s,o));let a=0;this.getDB().runTransaction([this.storeName],(t=>{let[r]=t,n=r;this.indexStore&&(n=r.index(this.indexStore));let o=new this.ZDB.DB_RANGE({low:null}),l=0;this.config.rollWithValue?n.openCursor(o,this.ZDB.Iterate_Direction.NEXT,{shouldStop:()=>l>=e,onValue:(e,t)=>{l++;let n=t.primaryKey;i(s,e),r.remove(n).then((()=>{a++}))}}):n.openKeyCursor(o,this.ZDB.Iterate_Direction.NEXT,{shouldStop:()=>l>=e,onValue:e=>{l++;let t=e;i(s,e),r.remove(t).then((()=>{a++}))}},{primaryKey:!!this.indexStore})}),this.ZDB.TransMode.READWRITE).then((()=>{t(a),this.handler.onComplete&&this.handler.onComplete(s,!0,a)})).catch((e=>{r(e),this.handler.onComplete&&this.handler.onComplete(s,!1,a)}))}))}__check(){return new Promise(((e,t)=>{if(!this.enable)return t("disable");let r=this.getStore();if(!r)return t("invalid_store");r.count().then((t=>{let r=this.__needRoll(t);if(r<=0)return e("no_need_to_roll");e(this.__runRoll(r))})).catch(t)}))}}const W=1,Y=2;class X{constructor(e,t,{UIN:r=""}={}){this.__briSrc=t,this.__briData=this._buildData(e,t),this.__keyEncrypt=r,this.__encryptAtts=[]}static get UI(){return W}static get DB(){return Y}static fromDB(e,t){return new this(e,X.DB,t)}static fromUI(e,t){return new this(e,X.UI,t)}_encrypt(e){return this.__keyEncrypt?u.encrypt(e,{key:this.__keyEncrypt}):e}_decrypt(e){return this.__keyEncrypt?u.decrypt(e,{key:this.__keyEncrypt}):e}_clone(e){if(!e)return e;try{return JSON.parse(JSON.stringify(e))}catch(t){console.error(t)}return e}_buildDataDB(e){return e}_buildDataUI(e){return e}_buildData(e,t){return t===X.DB?this._buildDataDB(e):t===X.UI?this._buildDataUI(e):e}_fromDB2UI(e){return e?(this.__encryptAtts&&this.__encryptAtts.forEach((t=>{if("string"==typeof t&&null!=e[t])try{e[t]=this._decrypt(e[t])}catch(r){0}})),e):e}_fromUI2DB(e){return e?(this.__encryptAtts&&this.__encryptAtts.forEach((t=>{if("string"==typeof t&&null!=e[t])try{e[t]=this._encrypt(e[t])}catch(r){0}})),e):e}_convert(e,t,r){return t===X.DB?r===X.UI&&(e=this._fromDB2UI(e)):t===X.UI&&r===X.DB&&(e=this._fromUI2DB(e)),e}validate(e){return!0}toDB(){return this._convert(this._clone(this.__briData),this.__briSrc,X.DB)}toUI(){return this._convert(this._clone(this.__briData),this.__briSrc,X.UI)}}Object.freeze({});class z extends X{constructor(...e){super(...e),this.__encryptAtts=["message"]}_fromDB2UI(e){return super._fromDB2UI(e)}_fromUI2DB(e){return super._fromUI2DB(e)}}Object.freeze({});class H extends X{constructor(...e){super(...e),this.__encryptAtts=["msg","attach"]}_fromDB2UI(e){return super._fromDB2UI(e)}_fromUI2DB(e){return super._fromUI2DB(e)}}Object.freeze({});class Q extends X{constructor(...e){super(...e),this.__encryptAtts=["message"]}_fromDB2UI(e){return super._fromDB2UI(e)}_fromUI2DB(e){return super._fromUI2DB(e)}}const $={symbol:1,string:2,number:3,boolean:4,bigint:5,object:6};const Z="ArraySchema",J="ObjectSchema",ee="DType",te=(e,t=!1)=>({required:!t,type:e,optional:()=>te(e,!0)}),re=e=>$[typeof e],ne=e=>null==e?null:e.constructor===oe?Z:e.constructor===se?J:e.constructor===Object&&e.type?ee:null;class oe{constructor(e){this.define(e),this.required=!0}optional(){return this.required=!1,this}trim(e){if(!Array.isArray(e))return e;let t=ne(this.schema),r=[...e];return t===J&&r.forEach(((e,t)=>{r[t]=this.schema.trim(e)})),r}validate(e){if(null==e)return!this.required;if(!Array.isArray(e))return!1;if(0===e.length)return!this.required;switch(ne(this.schema)){case J:case Z:for(let t=0;t<e.length;t++)if(!this.schema.validate(e[t]))return!1;return!0;case ee:for(let t=0;t<e.length;t++)if(re(e[t])!==this.schema.type)return!1;return!0;default:return!1}}define(e){if(null==e||null==ne(e))throw new Error("Schema type error");this.schema=e}}class se{constructor(e){this.define(e),this.required=!0}optional(){return this.required=!1,this}validate(e){if(null==e)return!this.required;if(e.constructor!==Object)return!1;if(0===Object.keys(e).length)return!this.required;let t=!0;return Object.keys(this.schema).forEach((r=>{switch(ne(this.schema[r])){case J:case Z:this.schema[r].validate(e[r])||(t=!1);break;case ee:if(null==e[r]&&!this.schema[r].required)break;re(e[r])!==this.schema[r].type&&(t=!1);break;default:t=!1}})),t}define(e){if(null==e||e.constructor!==Object)throw new Error("schema define must be an object");this.schema=Object.keys(e).reduce(((t,r)=>{const n=e[r];return Object(o.a)(Object(o.a)({},t),{},{[r]:n})}),this.schema||{})}trim(e){if(null==e||e.constructor!==Object)return e;let t=Object(o.a)({},e);return Object.keys(t).forEach((e=>{this.schema[e]?ne(this.schema[e])!==J&&ne(this.schema[e])!==Z||(t[e]=this.schema[e].trim(t[e])):delete t[e]})),t}}new se({actionId:te($.string),msgId:te($.string),cliMsgId:te($.string),msgType:te($.number),status:te($.number),notify:te($.string),mentions:new oe(new se({uid:te($.string),pos:te($.number),len:te($.number),type:te($.number)})).optional(),quote:new se({ownerId:te($.string),cliMsgId:te($.number),globalMsgId:te($.number),cliMsgType:te($.number),ts:te($.number),msg:te($.string),attach:te($.string),fromD:te($.string)}).optional(),message:te($.string),sendDttm:te($.string),fromUid:te($.string),toUid:te($.string),dName:te($.string),localDttm:te($.number),properties:te($.string).optional(),ttl:te($.number),src:te($.number),syncFromMobile:te($.boolean),topOut:te($.string),topOutTimeOut:te($.string),topOutImprTimeOut:te($.string),_localState:te($.string).optional()});var ie,ae={_metaData:{primaryKeys:["checksum"]},validator:new se({checksum:te($.string),dimension:new se({width:te($.number),height:te($.number),type:te($.number).optional(),bigRes:te($.boolean).optional(),orientation:new se({rotation:te($.number).optional(),flip:te($.boolean).optional()}).optional()}).optional(),url:te($.string)})};class le extends X{constructor(...e){super(...e),this.__encryptAtts=[]}_fromDB2UI(e){return super._fromDB2UI(e)}_fromUI2DB(e){if(e=super._fromUI2DB(e),e=ae.validator.trim(e),!ae.validator.validate(e))throw Error("SCHEMA_ITEM_IS_NOT_VALID");return e}}let he=__ZaBUNDLENAME__;const ue={WEB:["Core","Meta","Res","Qos","Reaction"],render:["Core","Meta","Res","Qos","Reaction"],embed:["Core","Meta","Res","Qos","Reaction"],login:["Core","Meta","Res","Qos","Reaction"],"zalo-log":[],videocall:[],photo:["Core","Meta","Res","Qos","Reaction"],screenshot:[],"db-task":["Core","Meta","Res","Qos"],znotification:[],"cpu-heavy-worker":[],"search-worker":["Search"],"preview-thumb-worker":[],"pdf-worker":[]},ce={};["Core","Meta","Res","Qos","Reaction","Search"].forEach((e=>{ce[e]=!1})),(null===(ie=ue[he])||void 0===ie?void 0:ie.length)&&ue[he].forEach((e=>{ce[e]=!0}));var de=ce;let fe={TransMode:h.h,Iterate_Direction:h.e,DB_RANGE:h.c,utils:u,IPC:R,Plugins:n};function me(e,t){return new B(U.build(U.TYPE.Core,{transformer:b,controller:T,rowItem:{message:z,uploaded_file_thumb:le}}))}function _e(){["Core","Search","Reaction"].forEach((e=>{var t;(null===(t=fe[e])||void 0===t?void 0:t.destroy)&&fe[e].destroy()})),fe.Core=me(),fe.Search=new k(U.build(U.TYPE.Search)),fe.Reaction=new k(U.build(U.TYPE.Reaction)),fe.Meta=new k(U.build(U.TYPE.Meta,{transformer:b,controller:T,rowItem:{ThreadMsg:H,MsgUrgency:Q}}))}const pe=["Core","Meta","Res","Qos","Reaction","Search"];pe.forEach((e=>{var t;de[e]||(null===(t=fe[e])||void 0===t?void 0:t.destroy)&&fe[e].destroy()})),fe=Object(o.a)(Object(o.a)({},fe),{},{setup:(e,t="")=>{var r;if(e){if(null===(r=fe.session)||void 0===r?void 0:r.userId){var n;if((null===(n=fe.session)||void 0===n?void 0:n.userId)===e)return;_e()}fe.session={userId:e,UIN:t},de.Core&&fe.Core.open(e,t).then((()=>{})).catch((e=>{})),de.Meta&&fe.Meta.open(e,t),de.Search&&fe.Search.open(e,t),de.Reaction&&fe.Reaction.open(e,t)}},setupUserIdOnly:e=>{e&&(fe.session||de.Reaction&&fe.Reaction.open(e,""))},setupNoUID:()=>{fe.__startedNoUID||(fe.__startedNoUID=!0,de.Qos&&fe.Qos.open(),de.Res&&fe.Res.open())},deleteAll:()=>new Promise(((e,t)=>{let r=[];pe.forEach((e=>{var t;(null===(t=fe[e])||void 0===t?void 0:t.delete)&&r.push(fe[e].delete())})),e(Promise.all(r))})),closeAll:()=>new Promise(((e,t)=>{pe.forEach((e=>{var t;de[e]&&((null===(t=fe[e])||void 0===t?void 0:t.destroy)&&fe[e].destroy())})),setTimeout((()=>{e()}),1e4)})),createNewCoreDB:me,initDBSession:_e,initDBWithoutSession:function(){fe.Qos=new k(U.build(U.TYPE.Qos)),fe.Res=new k(U.build(U.TYPE.Res))}});const ge=fe;ge.initDBSession(),ge.initDBWithoutSession(),ge.setupNoUID()},"7F/P":function(e,t,r){"use strict";r.r(t);var n=r("VTBJ"),o=(r("KFwE"),r("4c4j"));const s=Object.freeze({NAME:"sidx_",VERSION:1,ST_KW:"stkw",ST_KW_IDX:"keyword",ST_CONTENT:"stcont",ST_CONTENT_IDX:"msgId",ST_IDX:"stidx",ST_IDX_IDX:"keywordId"}),i=2e3,a=Number.MAX_SAFE_INTEGER-10,l=()=>{},h=Object.freeze({ADD_ALL_INDEX:1,GET_KEYWORD_ID:2,GET_CONTENT_ID:3});class u{constructor(e,{freqNeed:t,storeIndex:r,shouldStop:n}){this.token=e,this.listAvailableContentIds=[],this.stepCounter=0,this.flagEnd=0,this.storeIndex=r,this.freqNeed=t,this.shouldStop=n||l,this._minId=a,this._maxId=a,this.needOptimize=0,this._trimId=a}info(){return`[${this.token}][${this.flagEnd}][${this.listAvailableContentIds.length}][${this.minId()}][${this.maxId()}]`}renew({storeIndex:e,shouldStop:t}){this.storeIndex=e,this.shouldStop=t||l}active(){return this.listAvailableContentIds.length||0===this.flagEnd}valid(){return this.listAvailableContentIds.length}contentIds(){return[...this.listAvailableContentIds]}minId(){return this.valid()?(this._verifyDirty(),this._minId=this.listAvailableContentIds[this.listAvailableContentIds.length-1],this._minId):this.active()?this._minId:a}maxId(){return this.valid()?(this._verifyDirty(),this._maxId=this.listAvailableContentIds[0],this._maxId):this.active()?this._trimId:a}size(){return this.listAvailableContentIds.length}trim(e){if(e>=a)return 0;this._trimId=Math.min(e,this._trimId);let t=0;for(this._verifyDirty();this.listAvailableContentIds.length&&this.listAvailableContentIds[0]>=e;)t++,this.listAvailableContentIds.shift();return t}getNext(){return new Promise(((e,t)=>{let r=!1;const n=()=>{r||(r=!0,this._getNext().then(e).catch((t=>{this.flagEnd=1,e()})))};if(1==this.needOptimize)return this._optimize().then(n).catch(n);n()}))}_verifyDirty(){this._listDirty&&(this._listDirty=!1,this.listAvailableContentIds.sort(((e,t)=>t-e)))}_push(e){if(e>=this._trimId)return!1;if(this.listAvailableContentIds.length){this.listAvailableContentIds[this.listAvailableContentIds.length-1]<e&&(this._listDirty=!0)}return this.listAvailableContentIds.push(e),!0}_optimize(){return new Promise(((e,t)=>{if(this.flagEnd)return e();if(300-this.listAvailableContentIds.length<=0)return e();if(1!=this.needOptimize)return e();let r=this.stepCounter+500,n=this.stepCounter,s=!1,a=0;this.storeIndex.openCursor(new o.ZDB.DB_RANGE({low:this.token,only:!0}),o.ZDB.Iterate_Direction.PREV,{shouldStop:()=>this.shouldStop()||s,onValue:e=>{if(a++,!s)return e.contentId<this._trimId?(s=!0,void(this.stepCounter=Math.max(this.stepCounter,n-1))):void(n+=500)}},{maxLoop:i,advance:r,stepCount:500}).then((()=>{s?this.needOptimize=0:a==i&&(this.stepCounter=n,this.needOptimize=0),e()})).catch(t)}))}_getNext(){return new Promise(((e,t)=>{if(this.flagEnd)return e();if(300-this.listAvailableContentIds.length<=0)return e();let r=this.stepCounter,n=r;this.storeIndex.openCursor(new o.ZDB.DB_RANGE({low:this.token,only:!0}),o.ZDB.Iterate_Direction.PREV,{shouldStop:()=>this.shouldStop()||this.listAvailableContentIds.length>=300,onValue:e=>{this.stepCounter++,(null==e?void 0:e.freq)>=this.freqNeed&&this._push(e.contentId)&&(n=this.stepCounter)}},{maxLoop:i,advance:r}).then((()=>{if(this.shouldStop())t("aborted");else{if(this.stepCounter<=r)return this.flagEnd=1,e();this._trimId!==a&&!this.needOptimize&&this.stepCounter-n>=1e3&&(this.needOptimize+=1),e()}})).catch(t)}))}}var c=new class{constructor(){this.userId=null,this.MAX_RESULT_SEARCH=5e3,this.db=null,this._checkOldData=!1,this._lockAll=!1,this._process={[h.ADD_ALL_INDEX]:this._addAllIndex.bind(this),[h.GET_KEYWORD_ID]:this._getKeywordIds.bind(this),[h.GET_CONTENT_ID]:this._getContentIds.bind(this)}}setDataName(e,t){return new Promise(((r,n)=>{this.userId||(this.userId=e,o.ZDB.setup(e,t)),r()}))}delOldData(){return new Promise(((e,t)=>{e()}))}delAllData(){return new Promise(((e,t)=>{o.ZDB.Search.runTransaction([s.ST_CONTENT,s.ST_KW,s.ST_IDX],(e=>{e.length;for(let t=0;t<e.length;t++)e[t].clear()}),o.ZDB.TransMode.READWRITE).then(e).catch(t)}))}migrate(e){return new Promise(((e,t)=>{t("disable migrate")}))}checkOldDb(e){return new Promise(((e,t)=>t("disable checkOldDb")))}_needOverrideContent(e,t){try{if(!e.convId&&t.convId)return!0}catch(r){}return!1}_getContentIds(e,t=!1){return new Promise(((t,r)=>{let n={};o.ZDB.Search.runTransaction([s.ST_CONTENT],(t=>{let[r]=t,o=r.index(s.ST_CONTENT_IDX);e.forEach((e=>{(null==e?void 0:e.msgId)&&o.get(e.msgId).then((t=>{t||r.put(e).then((t=>{var r;(null==t||null===(r=t.target)||void 0===r?void 0:r.result)&&(n[e.msgId]=t.target.result)}))}))}))}),o.ZDB.TransMode.READWRITE).then((()=>{t(n)})).catch(r)}))}_getKeywordIds(e){return new Promise(((t,r)=>{let n={};o.ZDB.Search.runTransaction([s.ST_KW],(t=>{let[r]=t,o=r.index(s.ST_KW_IDX);e.forEach((e=>{o.get(e).then((t=>{(null==t?void 0:t.index)?n[e]=t.index:r.put({keyword:e}).then((t=>{var r,o;(null==t||null===(r=t.target)||void 0===r?void 0:r.result)&&(n[e]=null==t||null===(o=t.target)||void 0===o?void 0:o.result)}))}))}))}),o.ZDB.TransMode.READWRITE).then((()=>{t(n)})).catch(r)}))}_addAllIndex(e){return o.ZDB.Search.runTransaction([s.ST_IDX],(t=>{let[r]=t;e.forEach((e=>r.put(e)))}),o.ZDB.TransMode.READWRITE)}search(e,t,{limitForEachKeyword:r=400,cache:n={}}={}){return new Promise(((n,a)=>{o.ZDB.Search.runTransaction([s.ST_KW,s.ST_IDX,s.ST_CONTENT],(l=>{let[h,u,c]=l,d=h.index(s.ST_KW_IDX),f=u.index(s.ST_IDX_IDX),m=!1,_=!1,p=e.length,g=[],v=(e,t)=>{m||(m=!0,_=!0,e?n(g):a(t))},E=()=>!(!_&&!t()),I=null,y=(e,r)=>{if(E())return v(!1,"aborted!!");let n=new Set,s=e=>{(e=>!I||I.has(e))(e)&&n.add(e)},a=e.length,l=()=>{if(E())return v(!1,"aborted!!");if(--a,a<=0){if(I){let e=new Set;I.forEach((t=>{n.has(t)&&e.add(t)})),I=e}else I=n;if(0==I.size)return v(!0);--p,p<=0&&(()=>{let e=[];I&&I.forEach((t=>e.push(t)));let t=e.length,r=()=>{if(E())return v(!1,"aborted!!");--t,t<=0&&v(!0)};if(t<=0)return v(!0);e.forEach((e=>{c.get(e).then((e=>{g.push(e),r()})).catch(r)}))})()}};if(a<=0)return l();e.forEach((e=>{0;f.openCursor(new o.ZDB.DB_RANGE({low:e,only:!0}),o.ZDB.Iterate_Direction.PREV,{shouldStop:()=>{if(m||t())return!0},onValue:e=>{(null==e?void 0:e.freq)>=r&&s(e.contentId)}},{maxLoop:i}).then(l).catch(l)}))};e.forEach((e=>{0;let t=e.keyword,n=e.freq;d.getAllKeys(new o.ZDB.DB_RANGE({low:t,high:t+"￿"}),r).then((e=>{y(e,n)})).catch((e=>{y([],0)}))}))}),o.ZDB.TransMode.READONLY)}))}searchV2(e,t,{limitForEachKeyword:r=1500,cache:n={},progress:i=!1}={}){return new Promise(((h,c)=>{t=t||l,n.resultList||(n.maxAllMin=0,n.progress=0,n.session_progress=0,n.resultList=new Set,n.hasMore=0,n.hasRet=new Set,n.ret=[]);let d=!1,f=!1,m=e=>{_(!1,e)};const _=(e,r)=>{d||(d=!0,f=!0,e?(n.progress,n.ret,t(),h(n.ret)):(n.progress,c(r)))};o.ZDB.Search.runTransaction([s.ST_KW,s.ST_IDX,s.ST_CONTENT],(l=>{let[h,c,d]=l,p=h.index(s.ST_KW_IDX),g=c.index(s.ST_IDX_IDX),v=n.resultList.size,E=new Set,I=(Date.now(),()=>!(!f&&!t())),y=()=>{let e=Array.from(E).filter((e=>!n.hasRet.has(e)));if(!(null==e?void 0:e.length))return _(!0);let t=e.length,r=()=>{if(I())return _(!1,"aborted!!");--t,t<=0&&_(!0)};if(t<=0)return _(!0);e.forEach((e=>{d.get(e).then((t=>{n.hasRet.has(e)||(n.hasRet.add(e),n.ret.push(t)),r()})).catch(r)}))},b=(e=!1)=>{if(I())return _(!1,"aborted!!");e&&(n.session_progress=0),n.progress++,n.session_progress++;let t=[];n.tokenMap.forEach((e=>{t.push.apply(t,e.similarTokenIds)}));let r=[];t.forEach((e=>{r.push(e.getNext())})),Promise.all(r).then((e=>{n.maxAllMin=0,n.minAllMax=a;let r=!0;if(n.tokenMap.forEach((e=>{let t=e.similarTokenIds,o=[],s=0,i=0,a=!1;t.forEach((e=>{e.active()&&(a=!0,s=Math.max(s,e.minId()),i=Math.max(i,e.maxId()),e.valid()&&o.push.apply(o,e.contentIds()))})),a||(r=!1),e.set=new Set(o),n.minAllMax=Math.min(n.minAllMax,i),n.maxAllMin=Math.max(n.maxAllMin,s)})),!r)return n.hasMore=0,y();n.tokenMap.forEach((e=>{e.similarTokenIds=e.similarTokenIds.filter((e=>(!!e.active()||(!1))))}));let o=0,s=n.tokenMap[0].set.size,l=0;n.tokenMap.forEach(((e,t)=>{e.set.size<s&&(s=e.set.size,o=t)})),n.tokenMap.length>=2?n.tokenMap[o].set.forEach((e=>{n.resultList.has(e)||n.tokenMap.find((t=>!t.set.has(e)))||(n.resultList.add(e),E.add(e))})):n.tokenMap[0].set.forEach((e=>{n.resultList.has(e)||(n.resultList.add(e),E.add(e))}));let h=Math.min(n.maxAllMin,n.minAllMax+1),u=!1,c=!1;if(t.forEach((e=>{e.valid()?(l+=e.trim(h),u=!0):!c&&e.active()&&(c=!0)})),0==l&&!c)return n.hasMore=0,y();if(!u)return n.hasMore=0,y();if(i){if(n.resultList.size>v+20)return n.hasMore=1,y()}else if(n.resultList.size>5e3&&n.resultList.size>v+20)return n.hasMore=1,y();if(n.session_progress>=1e4)return n.hasMore=1,y();b()})).catch(m)},D=(e,t,r)=>I()?_(!1,"aborted!!"):(null==t?void 0:t.length)?(n.tokenMap=n.tokenMap||[],n.tokenMap.push({token:e,set:new Set,similarTokensCount:t.length,maxAllMin:0,similarTokenIds:t.map((e=>new u(e,{freqNeed:r,storeIndex:g,shouldStop:I}))),freqNeed:r}),T--,void(0===T&&b(!0))):_(!1,"not_found_token");if(n.progress)return n.tokenMap.forEach((e=>{e.similarTokenIds.forEach((e=>{e.renew({storeIndex:g,shouldStop:I})}))})),b(!0);let T=e.length;e.forEach((e=>{let t=e.keyword,n=e.freq;p.getAllKeys(new o.ZDB.DB_RANGE({low:t,high:t+"￿"}),r).then((e=>{D(t,e,n)})).catch((e=>{D(t,[],0)}))}))}),o.ZDB.TransMode.READONLY).then((()=>{_(!0)})).catch(m)}))}};var d=r("ES/k"),f=r("vFc7");let m=[],_=1,p=2,g=3,v=5,E=6,I=9,y={[_]:function(e,t,r,n){return new Promise(((o,s)=>{let i;i=t?()=>x(r,n):()=>!1;let a=d.a.formatTextSearch(e);if(!a)return o([]);let l=a.split(" "),h=l.length,u=new Array(h);u.fill(1);for(let e=0;e<h;++e)for(let t=0;t<h;++t)e!==t&&l[t].startsWith(l[e])&&u[e]++;let f=[],m=new Set;l.forEach(((e,t)=>{m.has(e)||(m.add(e),f.push({keyword:e,freq:u[t]}))})),f.sort(((e,t)=>t.freq==e.freq?t.keyword.length-e.keyword.length:t.freq-e.freq)),f.length>=5&&(f=f.slice(0,5));let _=null,p=[],g=!0,v=0,E={};const I=e=>{if(i())return s("aborted");c.searchV2(f,i,{limitForEachKeyword:e,cache:E,progress:!!n.progress}).then((e=>{let t=E.hasMore;if(t&&!n.progress)return I();if(n&&n.filter&&(e=M(e,n.filter)),!t||e.length>=c.MAX_RESULT_SEARCH)return o(e);if(p=e,!_)if(g){g=!1;let e=p?p.length:0;e!=v&&(v=e,j(p,r))}else _=setTimeout((()=>{_=null;let e=p?p.length:0;e!=v&&(v=e,j(p,r))}),600);I()})).catch((e=>{if(i())return s("aborted");o(p)}))};I()}))},[p]:function(e){return new Promise(((t,r)=>{c._addAllIndex(e.list).then((r=>{e.migrateData&&L(e.migrateData),t()})).catch(r)}))},[4]:function(e){return new Promise(((t,r)=>{c.setDataName(e.userId,e.UIN).then((()=>{t()})).catch((e=>{r(e)}))}))},[g]:function(e,t=!1,r,n){return new Promise(((t,r)=>{if(e.length>500){let t=e.slice(500,e.length);P({act:g,data:t,taskId:N.next(),isAbort:!1,additions:n,priority:1}),e=e.slice(0,500)}let o=[],s=[],i=new Set;e.forEach((e=>{if(i.has(e.msgId))return;i.add(e.msgId),s.push(d.a.getContentObject(e));let t=d.a.getTextFromMessage(e.content);d.a.getListItems(t,e.msgId,o)}));let a=!1;n&&n.constructor==Object&&n.migrate&&(a=!0),P({act:v,data:{indexList:o,contents:s,migrate:a},taskId:N.next(),isAbort:!1,priority:1}),t()}))},[v]:function(e){return new Promise(((t,r)=>{let{indexList:o,contents:s,migrate:i}=Object(n.a)({},e),a=2,l=null,h={},u={};i&&(l=e.migrateData);let d=[],f=new Set;o.forEach((e=>{f.has(e.keyword)||""==e.keyword||(f.add(e.keyword),d.push(e.keyword))}));let m=()=>{if(a--,!a){let e=[];if(o.forEach((t=>{h.hasOwnProperty(t.msgId)&&u.hasOwnProperty(t.keyword)&&e.push({keywordId:u[t.keyword],contentId:h[t.msgId],freq:t.freq})})),!l&&0===e.length)return t();P({act:p,data:{list:e,migrateData:l},taskId:N.next(),isAbort:!1,priority:1}),t()}};c._getContentIds(s,i).then((e=>{h=e,m()})).catch(m),c._getKeywordIds(d).then((e=>{u=e,m()})).catch(m)}))},[7]:function(e){return new Promise(((t,r)=>{c.migrate(e).then((e=>{e&&e.indexList.length>0?P({act:v,data:{indexList:e.indexList,contents:e.contents,migrate:!0,migrateData:{lowerKw:e.lowerKw,done:e.done}},taskId:N.next(),isAbort:!1,priority:1}):(e.lowerKw||e.done)&&L({lowerKw:e.lowerKw,done:e.done}),t()})).catch(r)}))},[8]:function(){return new Promise(((e,t)=>{c.delOldData().then((()=>{B("del old data success!!"),e()})).catch(t)}))},[I]:function(){return new Promise(((e,t)=>{c.delAllData().then((()=>{B("del all data"),e()})).catch(t)}))},[10]:function(e){return new Promise(((t,r)=>{let n=[];e.forEach((e=>{let t=[],r=function(){try{return 1}catch(e){return console.error(e),3}return 2}();e.content&&e.content.constructor==String&&(t=f.h.parseDataMessage(e.content.toLowerCase())),t.length>0&&t.forEach((t=>{t&&t.constructor===Array&&3===t.length&&n.push([f.a,e.msgKey,e.isGroup,t[0],t[1],e.msgId,e.content.length,e.ts,t[2],r].join("\t"))}))})),function(e){if(!e||0==e.length)return;F.push.apply(F,e),U&&clearTimeout(U);U=setTimeout((()=>{U=null,F.length>0&&self.postMessage({actionLog:!0,data:[...F]}),F=[]}),1e4)}(n),t()}))},[11]:function(e){return new Promise(((t,r)=>{B(e?"_initTagging"+e.length:"_initTagging data == null"),f.h.prepareData(e),t()}))},[15]:function(e){return new Promise((e=>{e()}))},[16]:function(e){return new Promise(((t,r)=>{c.__checkRoll((e||{}).limits),t()}))}};let b=2;let D=null;const T="_",w="with-filter-msgType",O="with-filter-convId",R="with-filter-convId_msgType",S={[T]:[O,R],[w]:[O,R],[O]:[T,w],[R]:[T,w]};const N=new class{constructor(){this.value=1}next(){return this.value++,this.value}};let A=new Map;function C(e){if(!e)return"_";let t="_";if(e.searchType)return e.searchType;if(e.filter){let r=Object.keys(e.filter);r.sort(((e,t)=>e==t?0:e>t?1:-1)),r.length&&(t="with-filter-"+r.join("_"))}return e.searchType=t,t}function x(e,t){let r=C(t);return e!=A.get(r)}function P(e){let t=!1;if(e.act==_){let t=C(e.additions);A.set(t,e.taskId),t&&S.hasOwnProperty(t)&&S[t].length&&S[t].forEach((t=>{A.set(t,e.taskId)}))}for(let o=0;o<m.length;++o)if(r=m[o],n=e,r.priority>=n.priority){m.splice(o,0,e),t=!0;break}var r,n;t||m.push(e),function(){if(1==b)return;b=1,k()}()}function k(){if(0==m.length)return b=2,D&&clearTimeout(D),void(D=setTimeout((()=>{B("FLAG_SLEEP_TOO_LONG"),D=null}),6e4));D&&(clearTimeout(D),D=null);let e=m.pop();y[e.act](e.data,e.isAbort,e.taskId,e.additions).then((t=>{e.callback&&self.postMessage({success:!0,data:t,taskId:e.taskId}),k()})).catch((t=>{e.callback&&self.postMessage({success:!1,data:t,taskId:e.taskId}),B("err "+e.act+" "+t),k()}))}function B(e){self.postMessage({logErr:!0,data:e})}function L(e){self.postMessage({migrate:!0,data:Object(n.a)({},e)})}function M(e,t){try{return e.filter((e=>{for(let r in t)if(t.hasOwnProperty(r)&&(!e||e[r]!=t[r]))return!1;return!0}))}catch(r){return e}}function j(e,t){self.postMessage({progress:!0,taskId:t,data:e})}self.onmessage=e=>{e.data;let t=e.data;switch(t.act){case E:A=new Map,m=m.filter((e=>e.act!=_));break;case I:m=[],P(t);break;default:P(t)}};let U,F=[]},AnMC:function(e,t,r){var n=r("wbIY"),o=r("QYBB"),s=r("LGyv");e.exports=n?function(e,t,r){return o.f(e,t,s(1,r))}:function(e,t,r){return e[t]=r,e}},Bvq2:function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},"ES/k":function(e,t,r){"use strict";const n=new class{constructor(){this._initFormatText()}getContentObject(e){return{msgId:e.msgId,convId:"0"==e.msgKey?e.idTo:e.msgKey,msgType:e.msgType}}getMessageWithNumKeyWords(e){let t="qwertyuiopasdfghjklzxcvbnm";const r=e=>{let r=[];for(let n=0;n<e;n++)r.push(t[Math.floor(Math.random()*t.length)]);return r.join("")};let n=["testtxt"];for(let o=0;o<e;o++)n.push(r(Math.floor(10*Math.random()+5)));return n.join(" ")}getListItems(e,t,r){let n=e.split(" "),o=new Array(n.length);o.fill(1);for(let a=0;a<n.length;++a)for(let e=0;e<n.length;++e)a!=e&&n[e].startsWith(n[a])&&++o[a];let s=r||[],i=new Set;return n.forEach(((e,r)=>{i.has(e)||(i.add(e),s.push({keyword:e,msgId:t,freq:o[r]}))})),s}getTextFromMessage(e){if(!e)return"";let t="";if(e.constructor==Object){let r=[];e.title&&r.push(JSON.stringify(e.title)),(e.description||e.desc)&&r.push(JSON.stringify(e.description||e.desc)),t=r.join(" ")}else t=e;return this.formatTextSearch(t)}isValidCharacter(e){return!(e.charCodeAt(0)<=879&&e.charCodeAt(0)>=768)}_initFormatText(){if(this.mapChar)return;this.mapChar={},this.validChar={};const e={a:"àáạảãâầấậẩẫăằắặẳẵ",e:"èéẹẻẽêềếệểễ",i:"ìíịỉĩ",o:"òóọỏõôồốộổỗơờớợởỡ",u:"ùúụủũưừứựửữ",y:"ỳýỵỷỹ",d:"đ"," ":"!@%^-*(){}+`=<>?/\\,.:;'\"&#[]~$_|\n\r\t"};for(let t in e){let r=e[t];for(let e of r)this.mapChar[e]=t}for(let t of"abcdefghijklmnopqrstuvwxyz0123456789 ")this.validChar[t]=!0}removeCombineCharacter(e){if(!e)return e;let t=[];for(let r of e)this.isValidCharacter(r)&&t.push(r);return t.join("")}simpleGetTextFromMessage(e){if(!e)return"";if(e.constructor==Object){let t=[];return e.title&&t.push(JSON.stringify(e.title)),(e.description||e.desc)&&t.push(JSON.stringify(e.description||e.desc)),this.removeCombineCharacter(t.join(" "))}return this.removeCombineCharacter(e)}formatTextSearch(e){try{e=e.toLowerCase().normalize(),this._initFormatText();let t=[];for(let r of e){let e=this.mapChar.hasOwnProperty(r)?this.mapChar[r]:r;" "==e?0!=t.length&&" "!=t[t.length-1]&&t.push(e):t.push(e)}for(;t.length>0&&" "==t[t.length-1];)t.pop();return t.join("")}catch(t){return""}}};t.a=n},GHVm:function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e}},KFwE:function(e,t,r){"use strict";r("ls82"),r("saaK");self.global=globalThis},L0gU:function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return i})),r.d(t,"h",(function(){return a})),r.d(t,"e",(function(){return l})),r.d(t,"g",(function(){return h})),r.d(t,"d",(function(){return u})),r.d(t,"f",(function(){return c}));const n={_value:Date.now(),next:()=>{let e=Math.max(n._value,Date.now());return e++,n._value=e,`dbjobid_${e}`}};class o{constructor(e,t,r,o){this.storeInfo=e,this.method=t,this.options=r,this.jobId=n.next(),this.options.params||(this.options.params=[]),this.defer=o}success(){var e;null===(e=this.defer)||void 0===e||e.resolve(...arguments)}error(){var e;null===(e=this.defer)||void 0===e||e.reject(...arguments)}}const s=Object.freeze({GET:"get",GET_BY_IDS:"getByIds",GET_ALL:"getAll",ADD:"add",ADD_IF_NOT_EXISTS:"addIfNotExists",REMOVE:"remove",ADD_OR_UPDATE:"addOrUpdate",RUN_TRANSACTION:"runTransaction",UPDATE_ITEM:"updateItem",UPDATE_ATTRS:"updateAttrs",CLEAR_STORE:"clearStore",COUNT:"count"});class i{constructor({low:e,high:t,excludeLow:r=!1,excludeHigh:n=!1,only:o=!1}={}){this.low=e,this.high=t,this.excludeLow=r,this.excludeHigh=n,this.only=o}toJSON(){return{low:this.low,high:this.high,excludeLow:this.excludeLow,excludeHigh:this.excludeHigh,only:this.only}}}const a={READONLY:"readonly",READWRITE:"readwrite"},l={PREV:"prev",NEXT:"next"},h={CONVERSATION:"conversation",FRIEND:"friend",GROUP:"group",MESSAGE:"message",IMAGE:"image",LINK:"link",FILE:"file",LABEL:"label",TTL_MSG:"ttlmsg",MENTION:"mention",STICKER:"sticker",GROUP_INFO:"group_info",STAR_MSG:"star_message",AVATAR:"avatar",GROUP_NOTICE:"group_notice",GROUP_POLL:"poll",AVA_HISTORY:"ava_history",GROUP_TOPIC_V2:"topic_v2",SETTING:"setting",BOARD_SUGGEST:"board_suggest",LAN_FRIEND:"lan_friend",HISTORY_ADD_FRIEND:"lan_add_friend_activities",LAN_DIRECTORY:"directory",DOWNLOAD_RETRY:"download_retry",NOTIFICATIONS:"notifications",UPLOADED_FILE_THUMB:"uploaded_file_thumb",TODO:"todo",CLOUD_SEGMENT:"cloud_segment"},u=Object.freeze({MESSAGE_INDEX_SECOND:"userId_sendDttm_msgId"}),c=Object.freeze({MAX_MSG_ID:"9999999999999999",MAX_SENDDTTM_ID:"9999999999999999"})},LGyv:function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},OsYe:function(e,t,r){(function(t){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||Function("return this")()}).call(this,r("kjmW"))},POgF:function(e,t,r){r("UbhR"),e.exports=r("OsYe")},QYBB:function(e,t,r){var n=r("wbIY"),o=r("d7IX"),s=r("b42z"),i=r("cWgI"),a=Object.defineProperty;t.f=n?a:function(e,t,r){if(s(e),t=i(t,!0),s(r),o)try{return a(e,t,r)}catch(n){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},RLqH:function(e,t,r){var n=r("wbIY"),o=r("cEPT"),s=r("LGyv"),i=r("pCEo"),a=r("cWgI"),l=r("eOcF"),h=r("d7IX"),u=Object.getOwnPropertyDescriptor;t.f=n?u:function(e,t){if(e=i(e),t=a(t,!0),h)try{return u(e,t)}catch(r){}if(l(e,t))return s(!o.f.call(e,t),e[t])}},UbhR:function(e,t,r){r("pevS")({global:!0},{globalThis:r("OsYe")})},VTBJ:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r("rePB");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}},Y4yM:function(e,t,r){var n=r("Bvq2"),o=r("/EgQ"),s="".split;e.exports=n((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==o(e)?s.call(e,""):Object(e)}:Object},ZBQp:function(e,t,r){var n=r("zJQS");e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}}},b42z:function(e,t,r){var n=r("39uu");e.exports=function(e){if(!n(e))throw TypeError(String(e)+" is not an object");return e}},cEPT:function(e,t,r){"use strict";var n={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,s=o&&!n.call({1:2},1);t.f=s?function(e){var t=o(this,e);return!!t&&t.enumerable}:n},cWgI:function(e,t,r){var n=r("39uu");e.exports=function(e,t){if(!n(e))return e;var r,o;if(t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;if("function"==typeof(r=e.valueOf)&&!n(o=r.call(e)))return o;if(!t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},d7IX:function(e,t,r){var n=r("wbIY"),o=r("Bvq2"),s=r("ejc7");e.exports=!n&&!o((function(){return 7!=Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},dktu:function(e,t){e.exports={}},eOcF:function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},ejc7:function(e,t,r){var n=r("OsYe"),o=r("39uu"),s=n.document,i=o(s)&&o(s.createElement);e.exports=function(e){return i?s.createElement(e):{}}},kjmW:function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(n){"object"==typeof window&&(r=window)}e.exports=r},ls82:function(e,t,r){var n=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(C){l=function(e,t,r){return e[t]=r}}function h(e,t,r,n){var o=t&&t.prototype instanceof p?t:p,s=Object.create(o.prototype),i=new S(n||[]);return s._invoke=function(e,t,r){var n=c;return function(o,s){if(n===f)throw new Error("Generator is already running");if(n===m){if("throw"===o)throw s;return A()}for(r.method=o,r.arg=s;;){var i=r.delegate;if(i){var a=w(i,r);if(a){if(a===_)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===c)throw n=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=f;var l=u(e,t,r);if("normal"===l.type){if(n=r.done?m:d,l.arg===_)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=m,r.method="throw",r.arg=l.arg)}}}(e,r,i),s}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(C){return{type:"throw",arg:C}}}e.wrap=h;var c="suspendedStart",d="suspendedYield",f="executing",m="completed",_={};function p(){}function g(){}function v(){}var E={};E[s]=function(){return this};var I=Object.getPrototypeOf,y=I&&I(I(N([])));y&&y!==r&&n.call(y,s)&&(E=y);var b=v.prototype=p.prototype=Object.create(E);function D(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function r(o,s,i,a){var l=u(e[o],e,s);if("throw"!==l.type){var h=l.arg,c=h.value;return c&&"object"==typeof c&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){r("next",e,i,a)}),(function(e){r("throw",e,i,a)})):t.resolve(c).then((function(e){h.value=e,i(h)}),(function(e){return r("throw",e,i,a)}))}a(l.arg)}var o;this._invoke=function(e,n){function s(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(s,s):s()}}function w(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,w(e,r),"throw"===r.method))return _;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return _}var o=u(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,_;var s=o.arg;return s?s.done?(r[e.resultName]=s.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,_):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,_)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function N(e){if(e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}return{next:A}}function A(){return{value:t,done:!0}}return g.prototype=b.constructor=v,v.constructor=g,g.displayName=l(v,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,a,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},D(T.prototype),T.prototype[i]=function(){return this},e.AsyncIterator=T,e.async=function(t,r,n,o,s){void 0===s&&(s=Promise);var i=new T(h(t,r,n,o),s);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},D(b),l(b,a,"Generator"),b[s]=function(){return this},b.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=N,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(R),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s],a=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var l=n.call(i,"catchLoc"),h=n.call(i,"finallyLoc");if(l&&h){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var s=o;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var i=s?s.completion:{};return i.type=e,i.arg=t,s?(this.method="next",this.next=s.finallyLoc,_):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),_},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),_}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;R(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),_}},e}(e.exports);try{regeneratorRuntime=n}catch(o){Function("r","regeneratorRuntime = r")(n)}},oOVA:function(e,t,r){var n=r("Bvq2"),o=/#|\.prototype\./,s=function(e,t){var r=a[i(e)];return r==h||r!=l&&("function"==typeof t?n(t):!!t)},i=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},a=s.data={},l=s.NATIVE="N",h=s.POLYFILL="P";e.exports=s},pCEo:function(e,t,r){var n=r("Y4yM"),o=r("GHVm");e.exports=function(e){return n(o(e))}},pevS:function(e,t,r){"use strict";var n=r("OsYe"),o=r("RLqH").f,s=r("oOVA"),i=r("dktu"),a=r("ZBQp"),l=r("AnMC"),h=r("eOcF"),u=function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t};e.exports=function(e,t){var r,c,d,f,m,_,p,g,v=e.target,E=e.global,I=e.stat,y=e.proto,b=E?n:I?n[v]:(n[v]||{}).prototype,D=E?i:i[v]||(i[v]={}),T=D.prototype;for(d in t)r=!s(E?d:v+(I?".":"#")+d,e.forced)&&b&&h(b,d),m=D[d],r&&(_=e.noTargetGet?(g=o(b,d))&&g.value:b[d]),f=r&&_?_:t[d],r&&typeof m==typeof f||(p=e.bind&&r?a(f,n):e.wrap&&r?u(f):y&&"function"==typeof f?a(Function.call,f):f,(e.sham||f&&f.sham||m&&m.sham)&&l(p,"sham",!0),D[d]=p,y&&(h(i,c=v+"Prototype")||l(i,c,{}),i[c][d]=f,e.real&&T&&!T[d]&&l(T,d,f)))}},rePB:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"a",(function(){return n}))},saaK:function(e,t,r){r("vnA6");var n=r("POgF");e.exports=n},vFc7:function(e,t,r){"use strict";r.d(t,"c",(function(){return n})),r.d(t,"b",(function(){return o})),r.d(t,"a",(function(){return s})),r.d(t,"d",(function(){return a})),r.d(t,"e",(function(){return h})),r.d(t,"g",(function(){return u})),r.d(t,"f",(function(){return c}));const n={TEXT:1,KEYWORD:2},o={TIME:1,MP3:2,FILE:3,POLL:4,TET_EFFECT:5,FIRE_EFFECT:6,TIME_REMIND:7,MENTION_BLACKLIST:8,GENERAL_BLACKLIST:12},s=5;class i{constructor(e,t=7907,r=1000000007){this._base=t,this._mod=r,this._mul=new Array(e+1),this._mul[0]=1;for(let n=1;n<=e;n++)this._mul[n]=this._mul[n-1]*t%r}hash(e){let t=0,r=(this._base,this._mod),n=this._mul;for(let o=0;o<e.length;o++)t+=e[o].charCodeAt(0)*n[o],t%=r;return t}}class a{constructor(){this.root={}}add(e,t){if(0==e.length)return;let r=this.root,n=0;for(;n<e.length;){let t=e[n];r[t]||(r[t]={}),r=r[t],n++}r.end=t}}class l{constructor(){this._dataLoaded=!1,this._separater={};for(let e of"!@%^-*(){}+`=<>?\\,.;'\"&#[]~$_| ")this._separater[e]=!0;this._endOfSentence={};for(let e of".;?!")this._endOfSentence[e]=!0;this.priority={}}_devData(){}keywordPriority(e){return e&&e.subType?this.priority[e.subType]:0}isEnabled(e){switch(e){case o.MP3:case o.FILE:case o.TIME:case o.TIME_REMIND:case o.MENTION_BLACKLIST:case o.POLL:case o.TET_EFFECT:case o.FIRE_EFFECT:case o.GENERAL_BLACKLIST:case o.MSG_INFO_PATTERN:return!0;default:return!1}}getBestKeyword(e,t={}){let r=null;if(e&&e.length)for(let n=0;n<e.length;n++){let o=e[n];this.keywordPriority(r)<this.keywordPriority(o)&&!t[o.subType]&&(r=o)}return r}getExtraInfo(e){return this._extraInfo&&this._extraInfo[e]}loadData(){fetch("https://f6-group-zf.zdn.vn/7b732d03ccdd208379cc/8693288286356885730").then((e=>e.json())).then((e=>{this.prepareData(e)})).catch((e=>{}))}transferKeyword(e){if(!e)return 0;let t=this._hash,r=0,n=0;for(let o=0;o<e.length;o++)r+=t._mul[n]*e[o].charCodeAt(0),r%=t._mod,n++;return r}prepareData(e,t=!1){this._trieTree=new a,this.data=e,this._hash=new i(3e3),t&&(this._extraInfo={});let r=this._hash;Date.now();e.forEach((e=>{let t=e.keyword,n=[],o=[e.type,e.id],s=0,i=0;for(let a=0;a<=t.length;a++)this._separater[t[a]]||a===t.length?(n.push(s),s=0,i=0):(s+=r._mul[i]*t[a].charCodeAt(0),s%=r._mod,i++);this._trieTree.add(n,o),this._extraInfo&&e.extInfo&&(this._extraInfo[e.id]=e.extInfo)})),this.skipOneSymbol=this.transferKeyword("skx"),this.skipToTheNextMatchSymbol=this.transferKeyword("nex"),this.endSymbol=this.transferKeyword("enx"),this._dataLoaded=!0}parseDataPosLenMessage(e){if(!e||e.constructor!=String)throw new Error("str "+e+" is not String");if(!this._dataLoaded)return[];Date.now();let t=[],r=this._hash,n=[],o=[],s=[],i=0,a=0,l=0;for(let c=0;c<=e.length;c++)c===e.length||this._separater[e[c]]?(n.push(i),o.push(l),s.push(a),i=0,l=0,a=c+1):(i+=r._mul[l]*e[c].charCodeAt(0),i%=r._mod,l++);let h=0,u=0;for(;h<n.length;){let e=this._trieTree.root,r=-1,i=h;for(u=h;e[n[u]];)e=e[n[u]],e.end&&(r=e.end,i=u),++u;if(-1!=r&&r.constructor==Array&&2==r.length){let e=[...r];e.push(s[h]),e.push(s[i]+o[i]-s[h]),t.push(e),h=i+1}else++h}return t}parseDataMessage(e){if(!e||e.constructor!=String)throw new Error("str "+e+" is not String");if(!this._dataLoaded)return[];Date.now();let t=[],r=this._hash,n=[],o=0,s=0;for(let l=0;l<=e.length;l++)l===e.length||this._separater[e[l]]?(n.push(o),o=0,s=0):(o+=r._mul[s]*e[l].charCodeAt(0),o%=r._mod,s++);let i=0,a=0;for(;i<n.length;){let e=this._trieTree.root,r=-1,o=i;for(a=i;e[n[a]];)e=e[n[a]],e.end&&(r=e.end,o=a),++a;if(-1!=r&&r.constructor==Array&&2==r.length){let e=[...r];e.push(i),t.push(e),i=o+1}else++i}return t}parseData(e){if(!e||e.constructor!=String)return e;if(!this._dataLoaded)return e;Date.now();let t=[],r=this._hash,o=[],s=[],i=[],a=0,l=0,h=[],u=e.toLowerCase();for(let n=0;n<=e.length;n++)n===e.length||this._separater[e[n]]?(o.push(a),i.push(s.join("")),n!==e.length?h.push(e[n]):h.push(""),s=[],a=0,l=0):(s.push(e[n]),a+=r._mul[l]*u[n].charCodeAt(0),a%=r._mod,l++);let c=[],d=e=>{c.length>0&&t.push({value:c.join(""),type:n.TEXT}),c=[]},f=0,m=0;for(;f<o.length;){let e,r,s=this._trieTree.root,a=-1;for(m=f;s[o[m]];){if(s=s[o[m]],s.end){let t=s.end;t&&t.constructor==Array&&t.length>1&&(a=m,e=t[0],r=t[1])}++m}if(-1!=a){d();let o=[];for(let e=f;e<=a;e++)o.push(i[e]),e!=a?o.push(h[e]):c.push(h[e]);t.push({value:o.join(""),type:n.KEYWORD,subType:e,id:r}),f=a+1}else c.push(i[f]),c.push(h[f]),++f}return d(),t}parseData_v2(e){if(!e||e.constructor!=String)return e;if(!this._dataLoaded)return e;Date.now();let t=[],r=this._hash,o=[],s=[],i=[],a=0,l=0,h=[],u=e.toLowerCase();for(let n=0;n<=e.length;n++)n===e.length||this._separater[e[n]]?(o.push(a),i.push(s.join("")),n!==e.length?(this._endOfSentence[e[n]]&&(o.push(this.endSymbol),i.push(""),h.push("")),h.push(e[n])):(o.push(this.endSymbol),i.push(""),h.push("","")),s=[],a=0,l=0):(s.push(e[n]),a+=r._mul[l]*u[n].charCodeAt(0),a%=r._mod,l++);let c=[],d=e=>{c.length>0&&t.push({value:c.join(""),type:n.TEXT}),c=[]},f=0,m=0;for(;f<o.length;){let e,r,s=this._trieTree.root,a=-1;m=f;let l=-1;for(;s&&o[m];){if(!s[o[m]]){l=-1;break}{s=s[o[m]];let t=s.end;!t||-1!==l&&l!==t[0]||t&&t.constructor==Array&&t.length>1&&(-1===l||l===t[0])&&(a=m,e=t[0],r=t[1])}++m}if(-1!=a){d();let o=[];for(let e=f;e<=a;e++)o.push(i[e]),e!=a?o.push(h[e]):c.push(h[e]);t.push({value:o.join(""),type:n.KEYWORD,subType:e,id:r}),f=a+1}else c.push(i[f]),c.push(h[f]),++f}return d(),t}}const h=new l,u=new l,c=new l,d=new l;t.h=d},vnA6:function(e,t,r){r("UbhR")},wbIY:function(e,t,r){var n=r("Bvq2");e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},zJQS:function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}}});